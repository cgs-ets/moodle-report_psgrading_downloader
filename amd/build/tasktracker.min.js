define(["core/ajax","core/url","core/templates"],function(r,a,l){let n;function d(){var e=(new Date-n)/1e3;console.log(`Process took ${e} seconds.`)}return{init:function(e,o){n=new Date,function o(n,t){console.log(`Checking task ID ${n} course ID `+t);r.call([{methodname:"report_psgrading_downloader_check_task_status",args:{taskid:n},done:function(e){if("complete"===e.status){let e=a.relativeUrl("/report/psgrading_downloader/download_reports.php",{taskid:n,courseid:t},!0);window.location.href=e,document.getElementById("psgrading-downloader-warning-alert").remove(),d()}else"failed"===e.status?(console.log("FAILED"),l.render("report_psgrading_downloader/alert_danger",{}).done(function(e,o){l.replaceNodeContents(document.getElementById("alert-container"),e,o)})):setTimeout(o(n,t),5e3)},fail:function(e){console.log(e)}}])}(e,o)}}});